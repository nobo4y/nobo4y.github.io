---
title: 记一次日志审计
layout: post
post-image: /assets/images/bg.jpg
description: 日志审计的常规流程及套路  
tags:
- 内网安全1
- 渗透测试
- 日志分析
---

# 日志分析     <!--需要言简意赅-->

​                                                                                                                       ——雷豹000     <!--各自的代号 如我的XF010101-->

## 前言

在应急响应中，日志分析是很重要的一步，根据日志信息可以判断是否存在攻击行为，分析攻击来源    <!--主要是阐述存在的问题，将问题描述清楚，可适当引出解决方案-->

## 日志分析

前段时间我在公网服务器上搭建了一个存在漏洞的系统，虽然及时关了，但为了安全起见，还是决定看看有没服务器有没有被攻击过。

首先查看服务器的WEB日志：![image-20210818101859358](/assets/images/20210820/1629253072.png)

在logs目录下找到2021-8-17日这天的access.log文件，复制下来放在本地，将.log后面的删除，打开来是这样的：

![image-20210818102504177](/assets/images/20210820/1629253499.png)

一看就是被攻击了，首先分析一下攻击行为

以这一条为例：
`45.146.164.110 - - [17/Aug/2021:14:27:59 +0800] "GET /solr/admin/info/system?wt=json HTTP/1.1" 404 2659`

45.146.164.110    代表的访问服务器的IP

 `- -`     第一个 - 代表连字符，表示请求的信息不可用。第二个 - 代表访问服务器的用户ID，这个ID是由HTTP身份验证来确定的，文档不受密码保护就为 -

[17/Aug/2021:14:27:59 +0800]     代表访问服务器时，服务器的时间。+0800表示服务器所处时区位于UTC之后的8小时。

GET /solr/admin/info/system?wt=json HTTP/1.1     代表请求的方法和访问的路径

404      代表服务器的状态码

2659    代表服务器发送给客户端的字节数，不包括响应头的信息。如果没有发送任何内容，就为 -



感觉这些攻击的路径样本可以收集起来当作御剑的字典用。先写个脚本收集一下：![image-20210823092245997](/assets/images/20210820/1629681733.png)

目前只是初步筛选，后序还得改进。

## 工具代码

`start = "/"
end = " "

with open("access.log","r",encoding="utf-8") as f:
	tmp = f.readlines()
	f.close()
for i in tmp:
	url = i.split(" - - ")[1][27:].split('"')[1]
	index1 = url.find(start)
	index2 = url[5:].find(end)
	urlend = url[index1:5+index2]
	if urlend == ""  or urlend == "/":
		continue;
	print(urlend)`
